{% extends 'base.html' %}
{% load static %}
{% load video_filters %}

{% block title %}{{ course.title }} - Ton Academy{% endblock %}

{% block content %}
<section class="course-detail-header">
    <div class="container">
        <div class="course-detail-wrapper {% if not course.image %}no-image{% endif %}">
            {% if course.image %}
            <div class="course-detail-image">
                <img src="{{ course.image.url }}" alt="{{ course.title }}" loading="lazy">
            </div>
            {% endif %}
            <div class="course-detail-info">
                <div class="course-info-inner">
                    <span class="course-level">{{ course.get_level_display }}</span>
                    <h1>{{ course.title }}</h1>
                    <p class="course-description">{{ course.description }}</p>
                    <div class="course-detail-meta">
                        <div class="meta-item">
                            <i class="fas fa-clock"></i>
                            <span>{{ course.duration }}</span>
                        </div>
                        <div class="meta-item price-item">
                            <span class="course-price">${{ course.price }}</span>
                        </div>
                    </div>
                    <div class="course-actions">
                        <button class="btn btn-primary btn-lg apply-course-btn" data-course-id="{{ course.id }}">
                            <i class="fas fa-paper-plane"></i> Hoziroq Ariza Berish
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

{% if course.promo_video_file %}
<section class="course-promo-video">
    <div class="container">
        <h2>Kurs Ko'rib Chiqish</h2>
        <div class="video-container">
            {% include 'includes/video_player.html' with video_file=course.promo_video_file %}
        </div>
    </div>
</section>
{% endif %}

{% if lesson_videos %}
<section class="course-lessons">
    <div class="container">
        <h2>Kurs Darslari</h2>
        <div class="lessons-grid">
            {% for video in lesson_videos %}
            <div class="lesson-card">
                {% if video.preview_image %}
                <div class="lesson-preview">
                    <img src="{{ video.preview_image.url }}" alt="{{ video.title }}" loading="lazy">
                    <button class="play-btn" data-video-id="{{ video.id }}">
                        <i class="fas fa-play"></i>
                    </button>
                </div>
                {% endif %}
                <div class="lesson-info">
                    <h3>{{ video.title }}</h3>
                    {% if video.description %}
                    <p>{{ video.description|truncatewords:15 }}</p>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</section>
{% endif %}

{% if testimonials %}
<section class="course-testimonials">
    <div class="container">
        <h2>Talabalar Sharhlari</h2>
        <div class="testimonials-grid">
            {% for testimonial in testimonials %}
            <div class="testimonial-card">
                {% if testimonial.student_photo %}
                <div class="testimonial-photo">
                    <img src="{{ testimonial.student_photo.url }}" alt="{{ testimonial.student_name }}" loading="lazy">
                </div>
                {% endif %}
                <div class="testimonial-content">
                    <div class="testimonial-rating">
                        {% for i in "12345" %}
                            <i class="fas fa-star {% if forloop.counter <= testimonial.rating %}active{% endif %}"></i>
                        {% endfor %}
                    </div>
                    <p class="testimonial-text">"{{ testimonial.text }}"</p>
                    <h4>{{ testimonial.student_name }}</h4>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</section>
{% endif %}

{% if related_courses %}
<section class="related-courses">
    <div class="container">
        <h2>O'xshash Kurslar</h2>
        <div class="courses-grid">
            {% for related_course in related_courses %}
            <div class="course-card">
                {% if related_course.image %}
                <div class="course-image">
                    <img src="{{ related_course.image.url }}" alt="{{ related_course.title }}" loading="lazy">
                </div>
                {% endif %}
                <div class="course-content">
                    <span class="course-level">{{ related_course.get_level_display }}</span>
                    <h3><a href="{% url 'blog:course_detail' related_course.pk %}">{{ related_course.title }}</a></h3>
                    <p>{{ related_course.description|truncatewords:20 }}</p>
                    <a href="{% url 'blog:course_detail' related_course.pk %}" class="btn btn-primary btn-sm">Batafsil</a>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</section>
{% endif %}

<!-- Application Modal -->
<div id="application-modal" class="modal">
    <div class="modal-content">
        <span class="close-modal">&times;</span>
        <h2>Kursga Ariza Berish</h2>
        <form id="application-form" method="post" action="{% url 'blog:apply_course' %}">
            {% csrf_token %}
            <input type="hidden" name="course" id="application-course-id" value="{{ course.id }}">
            <div class="form-group">
                <input type="text" name="name" class="form-control" placeholder="Ismingiz" required>
            </div>
            <div class="form-group">
                <input type="tel" name="phone" class="form-control" placeholder="Telefon Raqamingiz" required>
            </div>
            <div class="form-group">
                <input type="email" name="email" class="form-control" placeholder="Email Manzilingiz" required>
            </div>
            <div class="form-group">
                <textarea name="message" class="form-control" placeholder="Qo'shimcha Xabar (Ixtiyoriy)" rows="4"></textarea>
            </div>
            <button type="submit" class="btn btn-primary">Arizani Yuborish</button>
        </form>
    </div>
</div>
{% endblock %}

